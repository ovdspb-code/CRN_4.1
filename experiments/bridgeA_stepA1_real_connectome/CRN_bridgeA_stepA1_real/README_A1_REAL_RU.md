# Bridge‑A / Step A.1 — Реальный граф коннектома (Drosophila larva)

## 0) Ключевая договорённость
Синтетический MB‑surrogate разрешён **только** как Step A.0 (предварительная отладка кода).
Все доказательные результаты Bridge‑A (графики, таблицы, выводы) строятся **только** на **реальном графе коннектома**.

## 1) Источник данных
Шаг A.1 рассчитан на публичный коннектом личинки *Drosophila melanogaster* (L1), описанный в работе Winding et al., *Science* (2023).

Для удобства и воспроизводимости мы используем готовую выгрузку этого коннектома в виде ориентированного взвешенного графа (вес ребра = число синапсов) из каталога Netzschleuder (`fly_larva`).

Альтернатива (более «сырой» путь) — получать реконструкции через CATMAID (VirtualFlyBrain L1EM), но это существенно тяжелее с точки зрения кода и повторяемости.

## 2) Что делает код в этом пакете
Скрипт `scripts/run_stepA1_real_connectome.py`:

1) Загружает/читает исходный датасет коннектома (локально).
2) Строит `nx.DiGraph` с атрибутами узлов и рёбер.
3) Извлекает MB‑подграф (PN/KC/MBON + опционально APL/DAN) по строковым меткам в `cell_type`.
4) Делает QC‑отчёт и сохраняет артефакты для последующего прогонa через бенчмарк (Step A.2).

## 3) Быстрый запуск

### Вариант A: у вас уже скачан файл
Поддерживаемые форматы входа:
- `fly_larva.csv.zip` (рекомендуется)
- `fly_larva.xml.zst` (GraphML в zstd; требуется `pip install zstandard`)

Команда:

```bash
python scripts/run_stepA1_real_connectome.py \
  --input /path/to/fly_larva.csv.zip \
  --outdir outputs_real \
  --min_syn 5
```

### Вариант B: вы скачали вручную и хотите прогнать здесь
Если вы работаете в окружении без прямого доступа к интернету, просто:
1) скачайте `fly_larva.csv.zip`
2) положите рядом со скриптом
3) укажите `--input`.

## 4) Выходные артефакты
В `--outdir` создаются:
- `fly_larva_full_stats.json` (общие размеры, базовые QC)
- `fly_larva_mb.graphml` (MB‑подграф)
- `fly_larva_mb_nodes.csv` (таблица узлов)
- `fly_larva_mb_edgelist.csv` (таблица рёбер)
- `fly_larva_mb_stats.json` (размеры, степени, мотивы PN→KC→MBON)
- `fly_larva_mb_degree_hist.png` (QC‑гистограммы)
- `metadata.json` (параметры извлечения, версии)

## 5) Настраиваемые параметры
- `--min_syn`: отсечение слабых рёбер по числу синапсов (умолчание 5). Это **не** меняет исходные данные, только задаёт рабочий граф для моделирования.
- `--pn_regex`, `--kc_regex`, `--mbon_regex`: regex‑фильтры для выбора типов нейронов.

## 6) Что будет в Step A.2
Step A.2 подключает полученный `fly_larva_mb.graphml` к CRN‑бенчмарку:
- CRN (GKSL) vs CTQW vs CRW vs CRW‑thermal
- единые seeds/реализации (для честных baseline‑сравнений)
- выход: CSV‑таблицы + PNG‑фигуры для SI.

